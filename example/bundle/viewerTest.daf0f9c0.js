var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},a={},n=e.parcelRequire5b70;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in a){var n=a[e];delete a[e];var i={id:e,exports:{}};return t[e]=i,n.call(i.exports,i,i.exports),i.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){a[e]=t},e.parcelRequire5b70=n);var i=n("ilwiq"),o=n("kp7Te"),r=n("891vQ"),l=n("7lx9d"),s=n("jiuw3"),d=function(){var e=0,t=document.createElement("div");function a(e){return t.appendChild(e.dom),e}function n(a){for(var n=0;n<t.children.length;n++)t.children[n].style.display=n===a?"block":"none";e=a}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(a){a.preventDefault(),n(++e%t.children.length)}),!1);var i=(performance||Date).now(),o=i,r=0,l=a(new d.Panel("FPS","#0ff","#002")),s=a(new d.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=a(new d.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:a,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){r++;var e=(performance||Date).now();if(s.update(e-i,200),e>=o+1e3&&(l.update(1e3*r/(e-o),100),o=e,r=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:n}};d.Panel=function(e,t,a){var n=1/0,i=0,o=Math.round,r=o(window.devicePixelRatio||1),l=80*r,s=48*r,d=3*r,c=2*r,p=3*r,m=15*r,u=74*r,g=30*r,h=document.createElement("canvas");h.width=l,h.height=s,h.style.cssText="width:80px;height:48px";var f=h.getContext("2d");return f.font="bold "+9*r+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=a,f.fillRect(0,0,l,s),f.fillStyle=t,f.fillText(e,d,c),f.fillRect(p,m,u,g),f.fillStyle=a,f.globalAlpha=.9,f.fillRect(p,m,u,g),{dom:h,update:function(s,y){n=Math.min(n,s),i=Math.max(i,s),f.fillStyle=a,f.globalAlpha=1,f.fillRect(0,0,l,m),f.fillStyle=t,f.fillText(o(s)+" "+e+" ("+o(n)+"-"+o(i)+")",d,c),f.drawImage(h,p+r,m,u-r,g,p,m,u-r,g),f.fillRect(p+u-r,m,r,g),f.fillStyle=a,f.globalAlpha=.9,f.fillRect(p+u-r,m,r,o((1-s/y)*g))}}};var c=d,p=n("cVdfP"),m=n("4CEV9"),u=n("RPVlj"),g=n("5Rd1x");const h="https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config/",f=new URLSearchParams(window.location.search),y=parseInt(f.get("samples"))||-1,b="true"===f.get("hideUI"),w=parseInt(f.get("tiles"))||2,v={environmentIntensity:1,multipleImportanceSampling:!0,acesToneMapping:!0,tilesX:w,tilesY:w,samplesPerFrame:1,scale:1/window.devicePixelRatio,model:"",checkerboardTransparency:!0,enable:!0,bounces:10,pause:!1,displayImage:!1,imageMode:"overlay",imageOpacity:1,imageType:"dspbr-pt"};let x,M,T,S,F,E,R,C,I,P,k,A,L,D,B,O=!1,j=0;function U(){if(requestAnimationFrame(U),!(k.samples>=y&&-1!==y||(R.update(),F.style.display=v.displayImage?"inline-block":"none",F.style.opacity="side-by-side"===v.imageMode?1:v.imageOpacity,F.style.position="side-by-side"===v.imageMode?"initial":"absolute",F.style.width=I.domElement.style.width,F.style.height=I.domElement.style.height,O))){if((k.samples<1||!v.enable)&&I.render(D,P),v.enable&&0===j){const e=Math.floor(k.samples);if(T.innerText=`samples: ${e}`,k.material.materials.updateFrom(C.materials,C.textures),k.material.filterGlossyFactor=.5,k.material.bounces=v.bounces,k.material.physicalCamera.updateFrom(P),k.material.environmentIntensity=v.environmentIntensity,P.updateMatrixWorld(),!v.pause||k.samples<1)for(let e=0,t=v.samplesPerFrame;e<t;e++)k.update();I.autoClear=!1,A.render(I),I.autoClear=!0}else j>0&&j--;k.samples>=y&&-1!==y&&requestAnimationFrame((()=>{window.dispatchEvent(new Event("render-complete"))})),T.innerText=`Samples: ${Math.floor(k.samples)}`}}function z(){v.tilesX*v.tilesY!=1&&(j=1),k.reset()}async function G(){let e,t;E&&(S.classList.remove("checkerboard"),E.destroy(),E=null);const a=new i.LoadingManager,n=B[v.model];window.location.hash=v.model;let{orbit:d={},target:c={},dimensions:u={}}=n;const{verticalFoV:g=45,renderSkybox:f=!1,lighting:y="../../../shared-assets/environments/lightroom_14b.hdr"}=n;d=Object.assign({},{theta:0,phi:90,radius:1},d),c=Object.assign({},{x:0,y:0,z:0},c),u=Object.assign({},{width:768,height:768},u),d.radius=Math.max(d.radius,1e-5),O=!0,S.style.display="none",T.innerText="--",x.innerText="--",M.innerText="Loading",M.style.visibility="visible",q(),D.traverse((e=>{if(e.material){const t=e.material;for(const e in t)t[e]&&t[e].isTexture&&t[e].dispose()}})),C&&D.remove(C.scene);let w=new URL(n.model,h).toString();w=w.replace(/.*?glTF-Sample-Models/,"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master"),a.onLoad=async()=>{(new m.MaterialReducer).process(e),e.updateMatrixWorld();const a=new p.PathTracingSceneWorker,o=await a.generate(e,{onProgress:e=>{const t=Math.floor(100*e);M.innerText=`Building BVH : ${t}%`}});C=o,D.add(C.scene);const{bvh:r,textures:l,materials:h}=o,y=r.geometry,w=k.material;w.bvh.updateFrom(r),w.normalAttribute.updateFrom(y.attributes.normal),w.tangentAttribute.updateFrom(y.attributes.tangent),w.uvAttribute.updateFrom(y.attributes.uv),w.materialIndexAttribute.updateFrom(y.attributes.materialIndex),w.colorAttribute.updateFrom(y.attributes.color),w.textures.setTextures(I,2048,2048,l),w.materials.updateFrom(h,l),w.envMapInfo.updateFrom(t),a.dispose(),M.style.visibility="hidden",x.innerHTML=n.credit||"",x.style.visibility=n.credit?"visible":"hidden",function(){if(b)return;E&&E.destroy(),E=new s.GUI,E.add(v,"model",Object.keys(B)).onChange(G);const e=E.addFolder("path tracing");e.add(v,"enable"),e.add(v,"pause"),e.add(v,"scale",0,1).onChange((e=>{const t=window.devicePixelRatio;let{dimensions:a={}}=B[v.model];a=Object.assign({},{width:768,height:768},a);const{width:n,height:i}=a;k.setSize(n*t*e,i*t*e),k.reset()})),e.add(v,"multipleImportanceSampling").onChange((e=>{k.material.setDefine("FEATURE_MIS",Number(e)),k.reset()})),e.add(v,"acesToneMapping").onChange((e=>{I.toneMapping=e?i.ACESFilmicToneMapping:i.NoToneMapping})),e.add(v,"bounces",1,20,1).onChange((()=>{k.reset()})),e.add(v,"environmentIntensity",0,5).onChange((()=>{k.reset()}));const t=E.addFolder("comparison");t.add(v,"displayImage"),t.add(v,"imageMode",["overlay","side-by-side"]),t.add(v,"imageType",["dspbr-pt","filament","babylon","gltf-sample-viewer","model-viewer","rhodonite","stellar"]).onChange(q),t.add(v,"imageOpacity",0,1);const a=E.addFolder("resolution");a.add(v,"samplesPerFrame",1,10,1),a.add(v,"tilesX",1,10,1).onChange((e=>{k.tiles.x=e})),a.add(v,"tilesY",1,10,1).onChange((e=>{k.tiles.y=e})),a.open(),E.addFolder("background").add(v,"checkerboardTransparency").onChange((e=>{e?S.classList.add("checkerboard"):S.classList.remove("checkerboard")}))}(),y.computeBoundingSphere();const T=y.boundingSphere.radius;P.near=2*T/1e3,P.far=2*T,P.updateProjectionMatrix(),P.position.setFromSphericalCoords(d.radius,i.MathUtils.DEG2RAD*d.phi,i.MathUtils.DEG2RAD*d.theta),P.position.x+=c.x,P.position.y+=c.y,P.position.z+=c.z;const F=window.devicePixelRatio,{width:R,height:A}=u;I.setSize(R,A),I.setPixelRatio(F),k.setSize(R*F*v.scale,A*F*v.scale),P.aspect=R/A,P.fov=g,P.updateProjectionMatrix(),L.target.set(c.x,c.y,c.z),L.update(),P.updateMatrixWorld(),t.mapping=i.EquirectangularReflectionMapping,D.environment=t,f?(D.background=t,k.material.backgroundAlpha=1):(I.setClearAlpha(0),D.background=null,k.material.backgroundAlpha=0),k.reset(),S.style.display="flex",O=!1,v.checkerboardTransparency&&S.classList.add("checkerboard")};const F=new URL(y,h).toString();new r.RGBELoader(a).load(F,(e=>{t=e})),new l.GLTFLoader(a).setMeshoptDecoder(o.MeshoptDecoder).load(w,(t=>{e=t.scene}),(e=>{if(0!==e.total&&e.total>=e.loaded){const t=Math.floor(100*e.loaded/e.total);M.innerText=`Loading : ${t}%`}}))}function q(){F.src=`https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/goldens/${v.model}/${v.imageType}-golden.png`}!async function(){x=document.getElementById("credits"),M=document.getElementById("loading"),T=document.getElementById("samples"),S=document.getElementById("container"),F=document.querySelector("img"),b&&(S.style.background="transparent",document.body.style.background="transparent");I=new i.WebGLRenderer({antialias:!0}),I.outputEncoding=i.sRGBEncoding,I.toneMapping=i.ACESFilmicToneMapping,I.physicallyCorrectLights=!0,S.appendChild(I.domElement),D=new i.Scene;const e=window.innerWidth/window.innerHeight;P=new i.PerspectiveCamera(60,e,.01,500),P.position.set(-1,.25,1),k=new m.PathTracingRenderer(I),k.camera=P,k.alpha=!0,k.material=new m.PhysicalPathTracingMaterial,k.tiles.set(v.tiles,v.tiles),k.material.setDefine("FEATURE_MIS",Number(v.multipleImportanceSampling)),k.tiles.set(v.tilesX,v.tilesY),A=new u.FullScreenQuad(new i.MeshBasicMaterial({map:k.target.texture,blending:i.CustomBlending})),L=new g.OrbitControls(P,S),L.addEventListener("change",z),R=new c,b?(x.remove(),T.remove()):S.appendChild(R.dom);const{scenarios:t}=await(await fetch("https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config.json")).json();B={},t.forEach((e=>{B[e.name]=e}));let a=t[0].name;if(window.location.hash){const e=window.location.hash.substring(1).replaceAll("%20"," ");e in B&&(a=e)}v.model=a,G(),U()}();
//# sourceMappingURL=viewerTest.daf0f9c0.js.map
