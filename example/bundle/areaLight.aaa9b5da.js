var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},a={},n=e.parcelRequire5b70;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in a){var n=a[e];delete a[e];var i={id:e,exports:{}};return t[e]=i,n.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){a[e]=t},e.parcelRequire5b70=n);var i=n("ilwiq"),r=n("RPVlj"),o=n("5Rd1x"),d=n("4CEV9"),s=n("cVdfP"),l=n("891vQ"),h=n("jiuw3"),g=n("fUhpq"),m=n("7lx9d"),c=n("kp7Te");let u,p,w,C,L,b,y,f,v,F,I;const x={controls:!0,areaLight1Enabled:!0,areaLight1IsCircular:!1,areaLight1Intensity:2,areaLight1Color:"#ffffff",areaLight1Width:1,areaLight1Height:1,areaLight2Enabled:!0,areaLight2IsCircular:!1,areaLight2Intensity:10,areaLight2Color:"#ff0000",areaLight2Width:1.25,areaLight2Height:2.75,environmentIntensity:.03,environmentRotation:0,bounces:3,samplesPerFrame:1,resolutionScale:1/window.devicePixelRatio,filterGlossyFactor:.5,tiles:1,multipleImportanceSampling:!0};function M(){L[0].isCircular=x.areaLight1IsCircular,L[0].intensity=x.areaLight1Intensity,L[0].width=x.areaLight1Width,L[0].height=x.areaLight1Height,L[0].color.set(x.areaLight1Color).convertSRGBToLinear(),L[1].isCircular=x.areaLight2IsCircular,L[1].intensity=x.areaLight2Intensity,L[1].width=x.areaLight2Width,L[1].height=x.areaLight2Height,L[1].color.set(x.areaLight2Color).convertSRGBToLinear();const e=[];x.areaLight1Enabled&&e.push(L[0]),x.areaLight2Enabled&&e.push(L[1]),y.material.lights.updateFrom(e),y.reset()}function E(){const e=window.innerWidth,t=window.innerHeight,a=x.resolutionScale,n=window.devicePixelRatio;y.setSize(e*a*n,t*a*n),y.reset(),u.setSize(e,t),u.setPixelRatio(window.devicePixelRatio*a),f.aspect=e/t,f.updateProjectionMatrix()}function P(){requestAnimationFrame(P),y.material.materials.updateFrom(b.materials,b.textures),y.material.lights.updateFrom(L),y.material.filterGlossyFactor=x.filterGlossyFactor,y.material.environmentIntensity=x.environmentIntensity,y.material.environmentBlur=.35,y.material.bounces=x.bounces,f.updateMatrixWorld();for(let e=0,t=x.samplesPerFrame;e<t;e++)y.update();u.autoClear=!1,v.render(u),u.render(C,f),u.autoClear=!0,F.innerText=`Samples: ${Math.floor(y.samples)}`}window.innerWidth/window.innerHeight<.65&&(x.bounces=Math.min(x.bounces,10),x.resolutionScale*=.5,x.tiles=3),async function(){u=new i.WebGLRenderer({antialias:!0}),u.outputEncoding=i.sRGBEncoding,u.toneMapping=i.ACESFilmicToneMapping,document.body.appendChild(u.domElement),f=new i.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.025,500),f.position.set(0,.6,2.65),y=new d.PathTracingRenderer(u),y.camera=f,y.material=new d.PhysicalPathTracingMaterial,y.tiles.set(x.tiles,x.tiles),v=new r.FullScreenQuad(new i.MeshBasicMaterial({map:y.target.texture})),p=new o.OrbitControls(f,u.domElement),p.target.set(0,.33,-.08),f.lookAt(p.target),p.addEventListener("change",(()=>{y.reset()})),p.update(),f.lookAt(-.15,.33,-.08),F=document.getElementById("samples"),I=document.getElementById("loading");const e=(new l.RGBELoader).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/leadenhall_market_1k.hdr").then((e=>{y.material.envMapInfo.updateFrom(e)})),t=new i.Group,a=new i.Box3,{scene:n}=await(new m.GLTFLoader).setMeshoptDecoder(c.MeshoptDecoder).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/mercury-about-to-kill-argos/scene.glb");n.traverse((e=>{e.material&&(e.material.map=null)})),n.scale.setScalar(.01),n.position.x=.05,n.updateMatrixWorld(!0),a.setFromObject(n),n.position.y-=a.min.y,t.add(n);const S=new i.CylinderBufferGeometry(3.5,3.5,.05,60),R=new i.MeshPhysicalMaterial({color:new i.Color(10066329),metalness:.2,roughness:.02}),T=new i.Mesh(S,R);T.position.y=-.025,t.add(T),t.updateMatrixWorld();const A=new d.ShapedAreaLight(new i.Color(16777215),5,1,1);A.position.x=1.5,A.position.y=1,A.position.z=-.5,A.rotateZ(-Math.PI/4),A.rotateX(-Math.PI/2),A.isCircular=!1,t.add(A);const G=new d.ShapedAreaLight(new i.Color(16711680),15,1.25,2.75);G.position.y=1.25,G.position.z=-1.5,G.rotateX(Math.PI),G.isCircular=!1,t.add(G),L=[A,G],w=new g.TransformControls(f,u.domElement),w.addEventListener("objectChange",(()=>{y.material.lights.updateFrom(L),y.reset()})),w.addEventListener("dragging-changed",(e=>p.enabled=!e.value)),w.attach(A),w.setSize(.5),window.addEventListener("keydown",(function(e){switch(e.key){case"w":w.setMode("translate");break;case"e":w.setMode("rotate")}})),C=new i.Scene,C.add(w);const W=new s.PathTracingSceneWorker,k=W.generate(t,{onProgress(e){I.innerText=`Generating BVH ${Math.round(100*e)}%`}}).then((e=>{b=e;const{bvh:t,textures:a,materials:n,lights:i}=e,r=t.geometry,o=y.material;o.bvh.updateFrom(t),o.normalAttribute.updateFrom(r.attributes.normal),o.tangentAttribute.updateFrom(r.attributes.tangent),o.uvAttribute.updateFrom(r.attributes.uv),o.materialIndexAttribute.updateFrom(r.attributes.materialIndex),o.textures.setTextures(u,2048,2048,a),o.materials.updateFrom(n,a),o.lights.updateFrom(i),o.lightCount=i.length,W.dispose()}));await Promise.all([k,e]),document.getElementById("loading").remove(),E(),window.addEventListener("resize",E);const B=new h.GUI;B.add(x,"controls").onChange((e=>{w.enabled=e,w.visible=e}));const H=B.addFolder("Path Tracing");H.add(x,"tiles",1,4,1).onChange((e=>{y.tiles.set(e,e)})),H.add(x,"samplesPerFrame",1,10,1),H.add(x,"filterGlossyFactor",0,1).onChange((()=>{y.reset()})),H.add(x,"bounces",1,15,1).onChange((()=>{y.reset()})),H.add(x,"resolutionScale",.1,1).onChange((()=>{E()})),H.add(x,"multipleImportanceSampling").onChange((()=>{y.material.defines.FEATURE_MIS=x.multipleImportanceSampling?1:0,y.material.needsUpdate=!0,y.reset()})),H.close();const j=B.addFolder("Environment");j.add(x,"environmentIntensity",0,3).onChange((()=>{y.reset()})),j.add(x,"environmentRotation",0,2*Math.PI).onChange((e=>{y.material.environmentRotation.setFromMatrix4((new i.Matrix4).makeRotationY(e)),y.reset()})),j.close();const z=B.addFolder("Area Light 1");z.add(x,"areaLight1Enabled").name("enable").onChange(M),z.add(x,"areaLight1IsCircular").name("isCircular").onChange(M),z.add(x,"areaLight1Intensity",0,200).name("intensity").onChange(M),z.addColor(x,"areaLight1Color").name("color").onChange(M),z.add(x,"areaLight1Width",0,5).name("width").onChange(M),z.add(x,"areaLight1Height",0,5).name("height").onChange(M);const U=B.addFolder("Area Light 2");U.add(x,"areaLight2Enabled").name("enable").onChange(M),U.add(x,"areaLight2IsCircular").name("isCircular").onChange(M),U.add(x,"areaLight2Intensity",0,200).name("intensity").onChange(M),U.addColor(x,"areaLight2Color").name("color").onChange(M),U.add(x,"areaLight2Width",0,5).name("width").onChange(M),U.add(x,"areaLight2Height",0,5).name("height").onChange(M),M(),P()}();
//# sourceMappingURL=areaLight.aaa9b5da.js.map
